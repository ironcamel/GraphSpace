<html>
<head>
<title>Graph Space</title>
<link rel="stylesheet" href="[% request.uri_base %]/css/reset.css" />
<link rel="stylesheet" href="[% request.uri_base %]/css/text.css" />
<link rel="stylesheet" href="[% request.uri_base %]/css/960.css" />
<link rel="stylesheet" href="[% request.uri_base %]/css/graph-space.css" />
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.0/themes/smoothness/jquery-ui.css" />
<!--
-->
<script type="text/javascript" src="[% request.uri_base %]/js/graph-space.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js"></script>

<script>
function delete_tag(tag) {
    var url = '[% request.uri_base %]/graphs/[% graph_id %]/tags/' + tag;
    $.ajax({
        url: url,
        dataType: 'text',
        type: 'DELETE',
        error: function(xhr, text, err) { 
            alert('ajax error: ' + text);
        },
        success: function(data) {
            $('#tag_' + tag).remove();
        }
    });
}
</script>
<style>
input {
  margin-bottom: 5px;
}
</style>
</head>
<body>

<div class="container_12">
  <div class="grid_8">

    <div id="header">
      <h1>Graph Space</h1>
      <hr/>
      <h3>
        <script type="text/javascript" charset="utf-8">
            var texts = [
                'the final frontier',
                '... to explore strange new networks',
                '... to boldly go where no graph has gone before'
            ];
            var rand_index = Math.floor(Math.random() * texts.length)
            //document.write(texts[rand_index]);
        </script>
      </h3>
    </div>

    <div id="content-body">
        [% content %]
    </div>

  </div> <!-- grid_8 -->

  <div class="grid_4">
    <div>
      <a href="[% request.uri_base %]/graphs">All Graphs</a>
    </div>
    <div class="accordion">
      <h3><a href="#">Tags:</a></h3>
      <div>
      <ul id="tags" style="margin-bottom:4px">
      [% FOREACH tag IN graph_tags %]
          <li id="tag_[% tag.name %]" class="tag_cont">
          <a href="[% request.uri_base %]/graphs?tag=[% tag.name %]" target="_blank">[% tag.name %]</a>
          [% IF graph_id %]
          <a href="#" onclick="delete_tag('[% tag.name %]')">X</a>
          [% END %]
          </li>
      [% END %]
      </ul>
      [% IF graph_id %]
      <input id="new_tag" type="text" value=""/>
      <button id="add_tag" type="button">Add Tag</button>
      <script>
      $('#add_tag').button();
      $('#add_tag').click(function() {
          var new_tag = $('#new_tag');
          var tag = new_tag.val();
          if (!tag) {
              alert('No tag entered');
              return;
          }
          $.ajax({
              type: 'POST',
              url: '[% request.uri_base %]/graphs/[% graph_id %]/tags',
              data: tag,
              success: function(tag, textStatus) {
                  $('#tags').append(
                      '<li id="tag_' + tag.name + '" class="tag_cont">'
                      + '<a href="[% request.uri_base %]/graphs?tag='
                          + tag.name + '" target="_blank">'
                          + tag.name + '</a> '
                      + '<a href="#" onclick="delete_tag('
                          + "'" + tag.name + "'" + ')">X</a>'
                      + '</li>'
                  );
                  new_tag.val('');
              },
              dataType: 'json'
          });
      });
      </script>
      [% END %]
      </div>
    </div>
    [% IF graph_id %]
    <div class="accordion">
      <h3><a href="#">Search</a></h3>
      <div>
      <input id="search_inp" type="text" name="search" value="" />
      <div>
      <button id="search_btn" type="button">Search</button>
      <button id="clear_btn" type="button">Clear</button>
      </div>
      <script>
      $('#clear_btn').button();
      $('#clear_btn').click(function() {
          vis.visualStyleBypass(null);
      });
      $('#search_btn').button();
      $('#search_btn').click(function() {
          var search_term = $('#search_inp').val();
          //vis.select([node]);

          var bypass = { nodes: { }, edges: { } };
          var props = { 
              color: '#F00',
              //labelFontSize: 16,
              //labelFontColor: "#ff0000",
              labelFontWeight: "bold"
          };
          bypass['nodes'][search_term] = props;
          vis.visualStyleBypass(bypass);

      });
      </script>
      </div>
    </div>
    [% END %]
    [% IF graph_id %]
    <div id="graph_details_cont" class="accordion">
      <h3><a href="#">Graph Details</a></h3>
      <div id="graph_details"></div>
    </div>
    <div class="accordion">
      <h3><a href="#">Node Details</a></h3>
      <div id="node_details"></div>
    </div>
    [% END %]
  </div> <!-- grid_4 -->
  <script>
  $(function() {
      //$( "#accordion" ).accordion();
      $('.accordion').accordion({
          autoHeight: false,
          collapsible: true
      });
  });
  </script>

  <div class="clear"></div>

  <div class="grid_12">
  <!--
    Powered by <a href="http://perldancer.org/">Dancer</a> [% dancer_version %]
  -->
  </div>
</div> <!-- container_12 -->

</body>
</html>
